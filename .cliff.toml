[changelog]
# Changelog header
header = """
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).
"""

# Footer
footer = """
---
**Full Changelog**: https://github.com/sv4u/musicdl/compare/{previous_tag}...{new_tag}
"""

# Template for changelog body
body = """
{% if version %}\
## [{{ version }}](https://github.com/sv4u/musicdl/releases/tag/{{ version }}) - {{ timestamp | date(format="%Y-%m-%d") }}

{% else %}\
## [Unreleased]

{% endif %}\
{% if breaking.len() > 0 %}
### ⚠️ Breaking Changes

{% for commit in breaking %}
- {% if commit.scope %}**{{ commit.scope }}**: {% endif %}{{ commit.message | upper_first }}{% if commit.links %} ({{ commit.links | join(sep=", ") }}){% endif %}
{% endfor %}

{% endif %}\
{% for group, commits in commits | group_by(attribute="group") %}
### {{ group | upper_first }}

{% for commit in commits %}
- {% if commit.scope %}**{{ commit.scope }}**: {% endif %}{{ commit.message | upper_first }}{% if commit.links %} ({{ commit.links | join(sep=", ") }}){% endif %}
{% endfor %}

{% endfor %}
"""

# Git configuration
[git]
conventional_commits = true
filter_unconventional = true
split_commits = false
commit_parsers = [
    # Breaking changes (must come first)
    { message = "^feat!", group = "Breaking Changes", breaking = true },
    { message = "^fix!", group = "Breaking Changes", breaking = true },
    { message = "BREAKING CHANGE", group = "Breaking Changes", breaking = true },
    
    # Features by scope
    { message = "^feat\\(config\\)", group = "Features", scope = "Configuration" },
    { message = "^feat\\(downloader\\)", group = "Features", scope = "Downloader" },
    { message = "^feat\\(docker\\)", group = "Features", scope = "Docker" },
    { message = "^feat\\(ci\\)", group = "Features", scope = "CI/CD" },
    { message = "^feat\\(spotify\\)", group = "Features", scope = "Spotify" },
    { message = "^feat\\(cache\\)", group = "Features", scope = "Cache" },
    { message = "^feat\\(plan\\)", group = "Features", scope = "Plan Architecture" },
    { message = "^feat", group = "Features", default_scope = "General" },
    
    # Bug fixes by scope
    { message = "^fix\\(config\\)", group = "Bug Fixes", scope = "Configuration" },
    { message = "^fix\\(downloader\\)", group = "Bug Fixes", scope = "Downloader" },
    { message = "^fix\\(docker\\)", group = "Bug Fixes", scope = "Docker" },
    { message = "^fix\\(ci\\)", group = "Bug Fixes", scope = "CI/CD" },
    { message = "^fix\\(spotify\\)", group = "Bug Fixes", scope = "Spotify" },
    { message = "^fix\\(cache\\)", group = "Bug Fixes", scope = "Cache" },
    { message = "^fix\\(plan\\)", group = "Bug Fixes", scope = "Plan Architecture" },
    { message = "^fix\\(tests\\)", group = "Bug Fixes", scope = "Tests" },
    { message = "^fix\\(rate-limiter\\)", group = "Bug Fixes", scope = "Rate Limiter" },
    { message = "^fix", group = "Bug Fixes", default_scope = "General" },
    
    # Security fixes
    { message = "^fix\\(security\\)", group = "Security", scope = "Security" },
    { message = "security", group = "Security", scope = "Security", skip = false },
    
    # Documentation
    { message = "^docs", group = "Documentation", default_scope = "General" },
    
    # Refactoring
    { message = "^refactor", group = "Refactoring", default_scope = "General" },
    
    # Performance
    { message = "^perf", group = "Performance", default_scope = "General" },
    
    # Tests
    { message = "^test", group = "Tests", default_scope = "General" },
    
    # CI/CD
    { message = "^ci", group = "CI/CD", default_scope = "General" },
    
    # Build
    { message = "^build", group = "Build", default_scope = "General" },
    
    # Style
    { message = "^style", group = "Style", default_scope = "General" },
    
    # Chores
    { message = "^chore", group = "Chores", default_scope = "General" },
]

# Link parsing (for PR/issue references)
[git.link_parsers]
# Match PR references: (#123) or (PR #123)
pattern = '\(#(\d+)\)|\(PR #(\d+)\)'
href = "https://github.com/sv4u/musicdl/pull/$1"
text = "#$1"

# Match issue references: (#456) or (issue #456)
pattern = '\(#(\d+)\)|\(issue #(\d+)\)'
href = "https://github.com/sv4u/musicdl/issues/$1"
text = "#$1"

# Tag processing
[git.tag_pattern]
pattern = '^v(.*)$'

