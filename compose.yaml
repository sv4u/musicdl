version: '2.4'

services:
  musicdl:
    image: ghcr.io/sv4u/musicdl:latest
    container_name: musicdl
    hostname: musicdl
    restart: "no"
    network_mode: bridge
    environment:
      - CONFIG_PATH=${CONFIG_PATH:-/scripts/config.yaml}
      - TZ=${TZ:-America/Denver}
      - PYTHONUNBUFFERED=1
      # Spotify API credentials (required)
      # Option 1: Set directly (not recommended for production)
      # - SPOTIFY_CLIENT_ID=${SPOTIFY_CLIENT_ID}
      # - SPOTIFY_CLIENT_SECRET=${SPOTIFY_CLIENT_SECRET}
      # Option 2: Use .env file (recommended - ensure .env is in .gitignore)
      # Create a .env file with:
      #   SPOTIFY_CLIENT_ID=your_client_id
      #   SPOTIFY_CLIENT_SECRET=your_client_secret
      # Option 3: Use Docker secrets (most secure for production)
      # See Docker documentation for secret management
    volumes:
      # Music library - adjust path to match your TrueNAS dataset
      - /mnt/peace-house-storage-pool/peace-house-storage/Music:/download:rw
      # Uncomment and adjust path to use custom config file:
      # - /path/to/your/config.yaml:/scripts/config.yaml:ro
    working_dir: /download
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    # Resource limits (v2.x syntax for standalone Docker Compose)
    # These limits are enforced in non-Swarm mode (TrueNAS Scale uses standalone mode)
    mem_limit: 1g
    mem_reservation: 256m
    cpus: 2
    # Security options (uncomment if image supports non-root user)
    # Note: Check image documentation to verify if non-root execution is supported
    user: "3000:3000"  # Adjust UID/GID to match your dataset owner
    # read_only: true
    # tmpfs:
    #   - /tmp:rw,noexec,nosuid,size=100m

# Note: Scheduled execution is configured via TrueNAS Scale's built-in Task Scheduler (Cron Jobs)
# See truenas-scale/README.md for instructions on setting up scheduled execution

