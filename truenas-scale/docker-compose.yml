version: "3.8"

services:
  musicdl:
    image: musicdl:latest
    container_name: musicdl
    build:
      context: ..
      dockerfile: musicdl.Dockerfile
    volumes:
      # Mount your music library directory
      # Update this path to match your TrueNAS Scale dataset path
      - /mnt/pool/datasets/music:/download:rw
      # Optional: Override config file
      # - /mnt/pool/datasets/musicdl/config.yaml:/scripts/config.yaml:ro
    environment:
      - CONFIG_PATH=/scripts/config.yaml
    restart: "no"
    # Resource limits (adjust based on your system)
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: 2G
        reservations:
          cpus: "1"
          memory: 1G
    # Security options
    security_opt:
      - no-new-privileges:true
    # User/group (adjust to match your TrueNAS user)
    user: "1000:1000"
    # Health check (optional - checks if container is running)
    healthcheck:
      test: ["CMD", "python3", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
